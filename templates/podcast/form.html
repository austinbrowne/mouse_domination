{% extends "base.html" %}

{% block title %}{{ 'Edit' if episode else 'New' }} Episode - Mouse Domination{% endblock %}

{% block content %}
<div class="max-w-2xl mx-auto space-y-6">
    <h1 class="text-3xl font-bold text-gray-800">{{ 'Edit' if episode else 'New' }} Episode</h1>

    <form method="post" class="bg-white rounded-lg shadow p-6 space-y-4">
        <div class="grid md:grid-cols-4 gap-4">
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Episode #</label>
                <input type="number" name="episode_number" value="{{ episode.episode_number if episode else next_number }}" min="1"
                    class="w-full border rounded-lg px-3 py-2">
            </div>
            <div class="md:col-span-3">
                <label class="block text-sm font-medium text-gray-700 mb-1">Title *</label>
                <input type="text" name="title" value="{{ episode.title if episode else '' }}" required
                    class="w-full border rounded-lg px-3 py-2 focus:ring-2 focus:ring-primary-500">
            </div>
        </div>

        <div class="grid md:grid-cols-2 gap-4">
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">YouTube URL</label>
                <input type="url" name="youtube_url" value="{{ episode.youtube_url if episode else '' }}" placeholder="https://youtube.com/watch?v=..."
                    class="w-full border rounded-lg px-3 py-2">
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Publish Date</label>
                <input type="date" name="publish_date" value="{{ episode.publish_date.isoformat() if episode and episode.publish_date else '' }}"
                    class="w-full border rounded-lg px-3 py-2">
            </div>
        </div>

        <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Topics Discussed</label>
            <input type="text" name="topics" value="{{ episode.topics if episode else '' }}" placeholder="Mouse reviews, tier lists, etc."
                class="w-full border rounded-lg px-3 py-2">
        </div>

        <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Guests</label>
            <select name="guest_ids" multiple class="w-full border rounded-lg px-3 py-2 h-32">
                {% for contact in contacts %}
                    <option value="{{ contact.id }}" {% if episode and contact in episode.guests %}selected{% endif %}>
                        {{ contact.name }} ({{ contact.role|replace('_', ' ')|title }})
                    </option>
                {% endfor %}
            </select>
            <p class="text-xs text-gray-500 mt-1">Hold Ctrl/Cmd to select multiple</p>
        </div>

        <hr class="my-4">
        <h3 class="font-medium text-gray-800">Sponsorship</h3>

        <div class="grid md:grid-cols-3 gap-4">
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Sponsored?</label>
                <select name="sponsored" class="w-full border rounded-lg px-3 py-2">
                    <option value="no" {% if not episode or not episode.sponsored %}selected{% endif %}>No</option>
                    <option value="yes" {% if episode and episode.sponsored %}selected{% endif %}>Yes</option>
                </select>
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Sponsor Name</label>
                <input type="text" name="sponsor_name" value="{{ episode.sponsor_name if episode else '' }}"
                    class="w-full border rounded-lg px-3 py-2">
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Amount ($)</label>
                <input type="number" name="sponsor_amount" value="{{ episode.sponsor_amount if episode and episode.sponsor_amount else '' }}" step="0.01" min="0"
                    class="w-full border rounded-lg px-3 py-2">
            </div>
        </div>

        <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Notes</label>
            <textarea name="notes" rows="3" class="w-full border rounded-lg px-3 py-2">{{ episode.notes if episode else '' }}</textarea>
        </div>

        <div class="flex justify-between pt-4">
            <a href="{{ url_for('podcast.list_episodes') }}" class="text-gray-500 hover:text-gray-700">Cancel</a>
            <button type="submit" class="bg-primary-600 text-white px-6 py-2 rounded-lg hover:bg-primary-700 transition">
                {{ 'Save Changes' if episode else 'Create Episode' }}
            </button>
        </div>
    </form>
</div>
{% endblock %}
