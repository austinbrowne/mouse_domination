{# Inventory table partial - used by both full page and AJAX requests #}
<div class="bg-white rounded-xl border border-surface-200 overflow-hidden">
    {% if items %}
        <div class="overflow-x-auto">
            <table class="w-full sortable">
                <thead>
                    <tr class="border-b border-surface-200 bg-surface-50">
                        <th data-sort="name" class="text-left px-4 py-3 text-xs font-semibold text-gray-600 uppercase tracking-wider">Product</th>
                        <th data-sort="source" class="text-left px-4 py-3 text-xs font-semibold text-gray-600 uppercase tracking-wider hidden md:table-cell">Source</th>
                        <th data-sort="status" class="text-left px-4 py-3 text-xs font-semibold text-gray-600 uppercase tracking-wider">Status</th>
                        <th data-sort="date" data-sort-type="date" class="text-left px-4 py-3 text-xs font-semibold text-gray-600 uppercase tracking-wider hidden md:table-cell">Date</th>
                        <th class="text-left px-4 py-3 text-xs font-semibold text-gray-600 uppercase tracking-wider hidden lg:table-cell">Content</th>
                        <th data-sort="pl" data-sort-type="number" class="text-right px-4 py-3 text-xs font-semibold text-gray-600 uppercase tracking-wider">P/L</th>
                        <th class="text-right px-4 py-3 text-xs font-semibold text-gray-600 uppercase tracking-wider">Actions</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-surface-200">
                    {% for item in items %}
                        <tr class="hover:bg-surface-50 {% if item.deadline and not item.sold and item.status != 'reviewed' %}bg-red-50/50{% endif %}">
                            <td class="px-4 py-3" data-value="{{ item.product_name }}">
                                <div class="font-medium text-gray-900">{{ item.product_name }}</div>
                                <div class="text-xs text-gray-500 mt-0.5">
                                    {{ item.company.name if item.company else 'Unknown' }} &middot; {{ item.category|title }}
                                </div>
                                {% if item.deadline and item.status != 'reviewed' %}
                                    <div class="text-xs text-red-600 font-medium mt-0.5">Deadline: {{ item.deadline.strftime('%b %d') }}</div>
                                {% endif %}
                            </td>
                            <td class="px-4 py-3 hidden md:table-cell" data-value="{{ item.source_type }}">
                                <div x-data="inlineDropdown('{{ item.id }}', 'source_type', '{{ item.source_type }}')">
                                    <button type="button" x-ref="button" @click="toggleDropdown()"
                                        class="inline-flex items-center gap-1 text-xs font-medium px-2 py-1 rounded-full cursor-pointer hover:ring-2 hover:ring-primary-300 transition-all"
                                        :class="sourceTypeClasses[value]">
                                        <span x-text="sourceTypeLabels[value]"></span>
                                        <svg class="w-3 h-3 opacity-60" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                                        </svg>
                                    </button>
                                    <div x-show="open" @click.away="open = false" x-transition :style="dropdownStyle"
                                        class="z-50 bg-white border border-surface-200 rounded-lg shadow-lg py-1 min-w-[140px]">
                                        <button type="button" @click="updateField('review_unit')"
                                            class="w-full text-left px-3 py-1.5 text-xs hover:bg-primary-50" :class="{ 'bg-primary-50 font-medium': value === 'review_unit' }">Review Unit</button>
                                        <button type="button" @click="updateField('personal_purchase')"
                                            class="w-full text-left px-3 py-1.5 text-xs hover:bg-primary-50" :class="{ 'bg-primary-50 font-medium': value === 'personal_purchase' }">Personal Purchase</button>
                                    </div>
                                </div>
                            </td>
                            <td class="px-4 py-3" data-value="{{ item.status }}">
                                <div x-data="inlineDropdown('{{ item.id }}', 'status', '{{ item.status }}')">
                                    <button type="button" x-ref="button" @click="toggleDropdown()"
                                        class="inline-flex items-center gap-1 text-xs font-medium px-2 py-1 rounded-full cursor-pointer hover:ring-2 hover:ring-primary-300 transition-all"
                                        :class="statusClasses[value]">
                                        <span x-text="statusLabels[value]"></span>
                                        <svg class="w-3 h-3 opacity-60" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                                        </svg>
                                    </button>
                                    <div x-show="open" @click.away="open = false" x-transition :style="dropdownStyle"
                                        class="z-50 bg-white border border-surface-200 rounded-lg shadow-lg py-1 min-w-[120px]">
                                        <button type="button" @click="updateField('in_queue')"
                                            class="w-full text-left px-3 py-1.5 text-xs hover:bg-primary-50" :class="{ 'bg-primary-50 font-medium': value === 'in_queue' }">In Queue</button>
                                        <button type="button" @click="updateField('reviewing')"
                                            class="w-full text-left px-3 py-1.5 text-xs hover:bg-primary-50" :class="{ 'bg-primary-50 font-medium': value === 'reviewing' }">Reviewing</button>
                                        <button type="button" @click="updateField('reviewed')"
                                            class="w-full text-left px-3 py-1.5 text-xs hover:bg-primary-50" :class="{ 'bg-primary-50 font-medium': value === 'reviewed' }">Reviewed</button>
                                        <button type="button" @click="updateField('keeping')"
                                            class="w-full text-left px-3 py-1.5 text-xs hover:bg-primary-50" :class="{ 'bg-primary-50 font-medium': value === 'keeping' }">Keeping</button>
                                        <button type="button" @click="updateField('listed')"
                                            class="w-full text-left px-3 py-1.5 text-xs hover:bg-primary-50" :class="{ 'bg-primary-50 font-medium': value === 'listed' }">Listed</button>
                                        <button type="button" @click="updateField('sold')"
                                            class="w-full text-left px-3 py-1.5 text-xs hover:bg-primary-50" :class="{ 'bg-primary-50 font-medium': value === 'sold' }">Sold</button>
                                    </div>
                                </div>
                            </td>
                            <td class="px-4 py-3 hidden md:table-cell text-sm text-gray-500" data-value="{{ item.date_acquired.isoformat() if item.date_acquired else '' }}">
                                {{ item.date_acquired.strftime('%b %d, %Y') if item.date_acquired else '-' }}
                            </td>
                            <td class="px-4 py-3 hidden lg:table-cell">
                                <div class="flex gap-2">
                                    {% if item.short_url and item.short_url.strip() %}
                                        <a href="{{ item.short_url }}" target="_blank" class="text-xs text-primary-600 hover:text-primary-700 font-medium">Short</a>
                                    {% endif %}
                                    {% if item.video_url and item.video_url.strip() %}
                                        <a href="{{ item.video_url }}" target="_blank" class="text-xs text-primary-600 hover:text-primary-700 font-medium">Video</a>
                                    {% endif %}
                                    {% if (not item.short_url or not item.short_url.strip()) and (not item.video_url or not item.video_url.strip()) %}
                                        <span class="text-gray-400 text-sm">-</span>
                                    {% endif %}
                                </div>
                            </td>
                            <td class="px-4 py-3 text-right font-medium {% if item.profit_loss >= 0 %}text-emerald-600{% else %}text-red-600{% endif %}" data-value="{{ item.profit_loss }}">
                                ${{ "%.2f"|format(item.profit_loss) }}
                            </td>
                            <td class="px-4 py-3 text-right whitespace-nowrap">
                                <div class="flex items-center justify-end gap-2">
                                    {% if not item.sold and item.status == 'listed' %}
                                        <form action="{{ url_for('inventory.mark_sold', id=item.id) }}" method="post" class="inline">
                                            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                                            <button type="submit" class="inline-flex items-center px-3 py-1.5 text-sm font-medium rounded-lg bg-emerald-100 text-emerald-700 hover:bg-emerald-200">Sold</button>
                                        </form>
                                    {% endif %}
                                    <a href="{{ url_for('inventory.edit_item', id=item.id) }}" class="inline-flex items-center px-3 py-1.5 text-sm font-medium rounded-lg bg-primary-100 text-primary-700 hover:bg-primary-200">Edit</a>
                                    <form action="{{ url_for('inventory.delete_item', id=item.id) }}" method="post" class="inline" onsubmit="return confirm('Delete this item?')">
                                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                                        <button type="submit" class="inline-flex items-center px-3 py-1.5 text-sm font-medium rounded-lg bg-red-100 text-red-700 hover:bg-red-200">Delete</button>
                                    </form>
                                </div>
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% else %}
        <div class="p-12 text-center">
            <svg class="w-12 h-12 text-gray-300 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"/></svg>
            <p class="text-gray-500 mb-2">No inventory found</p>
            <a href="{{ url_for('inventory.new_item') }}" class="text-primary-600 hover:text-primary-700 font-medium text-sm">Add your first item</a>
        </div>
    {% endif %}
</div>

{# Summary stats for AJAX updates #}
<div id="inventory-stats" class="hidden" data-count="{{ items|length }}" data-profit-loss="{{ total_profit_loss }}"></div>

{# Chart data for AJAX updates #}
{% if chart_data %}
<script type="application/json" id="chart-data-json">{{ chart_data|tojson }}</script>
{% endif %}
