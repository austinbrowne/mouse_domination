{% extends "base.html" %}

{% block title %}{{ 'Edit' if guide else 'New' }} Episode - {{ podcast.name }} - {{ APP_NAME }}{% endblock %}

{% block content %}
<div class="space-y-6">
    {% include "podcasts/_subnav.html" %}

    <div class="max-w-2xl mx-auto space-y-6">
        <div class="flex items-center justify-between">
            <h1 class="text-xl font-bold text-gray-900">{{ 'Edit' if guide else 'New' }} Episode</h1>
        </div>

        <form method="post" class="bg-white rounded-xl border border-surface-200 p-6 space-y-4">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

            {% if not guide %}
            <!-- Template Selector (only for new guides) -->
            <div class="bg-primary-50 border border-primary-200 rounded-lg p-4">
                <label class="block text-sm font-medium text-primary-800 mb-2">Start from Template</label>
                {% if templates %}
                <select name="template_id" class="w-full border border-primary-200 rounded-lg px-3 py-2 bg-white focus:ring-2 focus:ring-primary-500 focus:border-primary-500">
                    <option value="">Blank Guide (no template)</option>
                    {% for template in templates %}
                    <option value="{{ template.id }}" {% if template.is_default %}selected{% endif %}>
                        {{ template.name }}{% if template.is_default %} (Default){% endif %}
                    </option>
                    {% endfor %}
                </select>
                <p class="text-xs text-primary-600 mt-1.5">Templates pre-fill intro/outro content, sections, and poll questions</p>
                {% else %}
                <p class="text-sm text-primary-700">No templates yet. <a href="{{ url_for('podcasts.new_template', podcast_id=podcast.id) }}" class="underline hover:text-primary-900">Create one</a> to pre-fill content for new guides.</p>
                {% endif %}
            </div>
            {% endif %}

            <div class="grid md:grid-cols-4 gap-4">
                <div class="md:col-span-2">
                    <label class="block text-sm font-medium text-gray-700 mb-1">Title <span class="text-red-500">*</span></label>
                    <input type="text" name="title" value="{{ guide.title if guide else '' }}" required
                        placeholder="e.g., Week of Jan 6th"
                        class="w-full border border-surface-200 rounded-lg px-3 py-2 focus:ring-2 focus:ring-primary-500 focus:border-primary-500">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Episode #</label>
                    <input type="number" name="episode_number" value="{{ guide.episode_number if guide and guide.episode_number else '' }}"
                        placeholder="42"
                        class="w-full border border-surface-200 rounded-lg px-3 py-2 focus:ring-2 focus:ring-primary-500 focus:border-primary-500">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Scheduled Date</label>
                    <input type="date" name="scheduled_date" value="{{ guide.scheduled_date.isoformat() if guide and guide.scheduled_date else '' }}"
                        class="w-full border border-surface-200 rounded-lg px-3 py-2 focus:ring-2 focus:ring-primary-500 focus:border-primary-500">
                </div>
            </div>

            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Notes</label>
                <textarea name="notes" rows="3" placeholder="Any prep notes for this episode..."
                    class="w-full border border-surface-200 rounded-lg px-3 py-2 focus:ring-2 focus:ring-primary-500 focus:border-primary-500">{{ guide.notes if guide else '' }}</textarea>
            </div>

            <div class="flex justify-between items-center pt-4 border-t border-surface-200">
                <a href="{{ url_for('podcasts.list_episodes', podcast_id=podcast.id) }}" class="text-gray-500 hover:text-gray-700">Cancel</a>
                <button type="submit" class="bg-primary-600 text-white px-6 py-2 rounded-lg hover:bg-primary-700 font-medium">
                    {{ 'Save Changes' if guide else 'Create Episode' }}
                </button>
            </div>
        </form>
    </div>
</div>
{% endblock %}
