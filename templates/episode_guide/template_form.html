{% extends "base.html" %}

{% block title %}{{ 'Edit' if template else 'New' }} Template - {{ APP_NAME }}{% endblock %}

{% block content %}
<div class="max-w-3xl mx-auto space-y-6">
    <!-- Header -->
    <div class="flex items-center justify-between">
        <div>
            <h1 class="text-2xl font-bold text-gray-900">{{ 'Edit' if template else 'New' }} Episode Guide Template</h1>
            <p class="text-sm text-gray-500 mt-1">Define default sections, intro/outro content, and poll questions</p>
        </div>
        <a href="{{ url_for('episode_guide.list_templates') }}"
           class="inline-flex items-center gap-2 px-4 py-2 text-sm font-medium rounded-lg bg-gray-100 text-gray-700 hover:bg-gray-200">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/></svg>
            Cancel
        </a>
    </div>

    <!-- Form -->
    <form method="POST" class="space-y-6">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

        <!-- Basic Info -->
        <div class="bg-white rounded-xl border border-surface-200 p-6">
            <h2 class="text-lg font-semibold text-gray-900 mb-4">Basic Information</h2>
            <div class="space-y-4">
                <div>
                    <label for="name" class="block text-sm font-medium text-gray-700 mb-1">Template Name *</label>
                    <input type="text" name="name" id="name" required maxlength="100"
                           value="{{ template.name if template else '' }}"
                           placeholder="e.g., MouseCast Standard, Quick News Format"
                           class="w-full border border-surface-200 rounded-lg px-3 py-2 focus:ring-2 focus:ring-primary-500 focus:border-primary-500">
                </div>
                <div>
                    <label for="description" class="block text-sm font-medium text-gray-700 mb-1">Description</label>
                    <textarea name="description" id="description" rows="2"
                              placeholder="Brief description of when to use this template"
                              class="w-full border border-surface-200 rounded-lg px-3 py-2 focus:ring-2 focus:ring-primary-500 focus:border-primary-500">{{ template.description if template else '' }}</textarea>
                </div>
                <div class="flex items-center gap-2">
                    <input type="checkbox" name="is_default" id="is_default"
                           {% if template and template.is_default %}checked{% endif %}
                           class="w-4 h-4 text-primary-600 border-gray-300 rounded focus:ring-primary-500">
                    <label for="is_default" class="text-sm text-gray-700">Set as default template for new guides</label>
                </div>
            </div>
        </div>

        <!-- Default Sections -->
        <div class="bg-white rounded-xl border border-surface-200 p-6">
            <h2 class="text-lg font-semibold text-gray-900 mb-2">Default Sections</h2>
            <p class="text-sm text-gray-500 mb-4">Select which sections to include by default in guides using this template</p>
            <div class="grid grid-cols-2 sm:grid-cols-3 gap-3">
                {% set selected_keys = [] %}
                {% if template and template.default_sections %}
                    {% for s in template.default_sections %}
                        {% set _ = selected_keys.append(s.key) %}
                    {% endfor %}
                {% endif %}
                {% for key, name, parent in all_sections %}
                    <label class="flex items-center gap-2 p-3 rounded-lg border border-surface-200 hover:bg-surface-50 cursor-pointer">
                        <input type="checkbox" name="default_sections" value="{{ key }}"
                               {% if key in selected_keys or (not template and key in ['introduction', 'news_mice', 'community_recap', 'outro']) %}checked{% endif %}
                               class="w-4 h-4 text-primary-600 border-gray-300 rounded focus:ring-primary-500">
                        <span class="text-sm text-gray-700">
                            {{ name }}
                            {% if parent %}
                                <span class="text-gray-400">({{ parent }})</span>
                            {% endif %}
                        </span>
                    </label>
                {% endfor %}
            </div>
        </div>

        <!-- Intro Static Content -->
        <div class="bg-white rounded-xl border border-surface-200 p-6">
            <h2 class="text-lg font-semibold text-gray-900 mb-2">Intro Static Content</h2>
            <p class="text-sm text-gray-500 mb-4">Reminder text shown at the top of the intro section (one item per line)</p>
            <textarea name="intro_static_content" id="intro_static_content" rows="5"
                      placeholder="Hello everyone! Welcome to the show&#10;Subscribe&#10;Join our Discord"
                      class="w-full border border-surface-200 rounded-lg px-3 py-2 font-mono text-sm focus:ring-2 focus:ring-primary-500 focus:border-primary-500">{% if template and template.intro_static_content %}{{ template.intro_static_content | join('\n') }}{% elif not template %}{{ default_intro | join('\n') }}{% endif %}</textarea>
        </div>

        <!-- Outro Static Content -->
        <div class="bg-white rounded-xl border border-surface-200 p-6">
            <h2 class="text-lg font-semibold text-gray-900 mb-2">Outro Static Content</h2>
            <p class="text-sm text-gray-500 mb-4">Reminder text shown at the top of the outro section (one item per line)</p>
            <textarea name="outro_static_content" id="outro_static_content" rows="5"
                      placeholder="Thank you for listening&#10;See you next week"
                      class="w-full border border-surface-200 rounded-lg px-3 py-2 font-mono text-sm focus:ring-2 focus:ring-primary-500 focus:border-primary-500">{% if template and template.outro_static_content %}{{ template.outro_static_content | join('\n') }}{% elif not template %}{{ default_outro | join('\n') }}{% endif %}</textarea>
        </div>

        <!-- Default Poll Questions -->
        <div class="bg-white rounded-xl border border-surface-200 p-6">
            <h2 class="text-lg font-semibold text-gray-900 mb-2">Default Poll Questions</h2>
            <p class="text-sm text-gray-500 mb-4">Pre-fill poll question fields in new guides</p>
            <div class="space-y-4">
                <div>
                    <label for="default_poll_1" class="block text-sm font-medium text-gray-700 mb-1">Poll Question 1</label>
                    <input type="text" name="default_poll_1" id="default_poll_1" maxlength="200"
                           value="{{ template.default_poll_1 if template else '' }}"
                           placeholder="e.g., What's your main mouse right now?"
                           class="w-full border border-surface-200 rounded-lg px-3 py-2 focus:ring-2 focus:ring-primary-500 focus:border-primary-500">
                </div>
                <div>
                    <label for="default_poll_2" class="block text-sm font-medium text-gray-700 mb-1">Poll Question 2</label>
                    <input type="text" name="default_poll_2" id="default_poll_2" maxlength="200"
                           value="{{ template.default_poll_2 if template else '' }}"
                           placeholder="e.g., Which brand makes the best mousepads?"
                           class="w-full border border-surface-200 rounded-lg px-3 py-2 focus:ring-2 focus:ring-primary-500 focus:border-primary-500">
                </div>
            </div>
        </div>

        <!-- Submit -->
        <div class="flex justify-end gap-3">
            <a href="{{ url_for('episode_guide.list_templates') }}"
               class="px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50">
                Cancel
            </a>
            <button type="submit"
                    class="px-6 py-2 bg-primary-600 text-white text-sm font-medium rounded-lg hover:bg-primary-700 shadow-sm">
                {{ 'Save Changes' if template else 'Create Template' }}
            </button>
        </div>
    </form>
</div>
{% endblock %}
